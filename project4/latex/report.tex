%% USEFUL LINKS:
%% -------------
%%
%% - UiO LaTeX guides:          https://www.mn.uio.no/ifi/tjenester/it/hjelp/latex/
%% - Mathematics:               https://en.wikibooks.org/wiki/LaTeX/Mathematics
%% - Physics:                   https://ctan.uib.no/macros/latex/contrib/physics/physics.pdf
%% - Basics of Tikz:            https://en.wikibooks.org/wiki/LaTeX/PGF/Tikz
%% - All the colors!            https://en.wikibooks.org/wiki/LaTeX/Colors
%% - How to make tables:        https://en.wikibooks.org/wiki/LaTeX/Tables
%% - Code listing styles:       https://en.wikibooks.org/wiki/LaTeX/Source_Code_Listings
%% - \includegraphics           https://en.wikibooks.org/wiki/LaTeX/Importing_Graphics
%% - Learn more about figures:  https://en.wikibooks.org/wiki/LaTeX/Floats,_Figures_and_Captions
%% - Automagic bibliography:    https://en.wikibooks.org/wiki/LaTeX/Bibliography_Management  (this one is kinda difficult the first time)
%%
%%                              (This document is of class "revtex4-1", the REVTeX Guide explains how the class works)
%%   REVTeX Guide:              http://www.physics.csbsju.edu/370/papers/Journal_Style_Manuals/auguide4-1.pdf
%%
%% COMPILING THE .pdf FILE IN THE LINUX IN THE TERMINAL
%% ----------------------------------------------------
%%
%% [terminal]$ pdflatex report_example.tex
%% 
%% Run the command twice, always.
%%
%% When using references, footnotes, etc. you should run the following chain of commands:
%%
%% [terminal]$ pdflatex report_example.tex
%% [terminal]$ bibtex report_example
%% [terminal]$ pdflatex report_example.tex
%% [terminal]$ pdflatex report_example.tex
%%
%% This series of commands can of course be gathered into a single-line command:
%% [terminal]$ pdflatex report_example.tex && bibtex report_example.aux && pdflatex report_example.tex && pdflatex report_example.tex
%%
%% ----------------------------------------------------


\documentclass[english,notitlepage,reprint,nofootinbib]{revtex4-1}  % defines the basic parameters of the document
% For preview: skriv i terminal: latexmk -pdf -pvc filnavn
% If you want a single-column, remove "reprint" 

% Allows special characters (including æøå)
\usepackage[utf8]{inputenc}
% \usepackage[english]{babel}

%% Note that you may need to download some of these packages manually, it depends on your setup.
%% I recommend downloading TeXMaker, because it includes a large library of the most common packages.

\usepackage{physics,amssymb}  % mathematical symbols (physics imports amsmath)
\include{amsmath}
\usepackage{graphicx}         % include graphics such as plots
\usepackage{xcolor}           % set colors
\usepackage{hyperref}         % automagic cross-referencing
\usepackage{listings}         % display code
\usepackage{subfigure}        % imports a lot of cool and useful figure commands
% \usepackage{float}
%\usepackage[section]{placeins}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{subfigure}
\usepackage{tikz}
\usetikzlibrary{quantikz}
% defines the color of hyperref objects
% Blending two colors:  blue!80!black  =  80% blue and 20% black
\hypersetup{ % this is just my personal choice, feel free to change things
    colorlinks,
    linkcolor={red!50!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}}


% ===========================================


\begin{document}

\title{2D Ising model}  % self-explanatory
\author{Sverre Wehn Noremsaune, Jon Aleksander Prøitz, Marius Torsvoll, Frida Marie Engøy Westby} % self-explanatory
\date{\today}                             % self-explanatory
\noaffiliation                            % ignore this, but keep it.

%This is how we create an abstract section.
\begin{abstract}
    This paper will present the results of a Markov-Chain Monte Carlo simulation of the 2D-Ising model. The model results in a numerical
    simulation of the ferro magnetic spin. The use of the lattice model allows the modelling of expectation values and the development
    of a larger 2-dimensional lattice model. This model predicts the critical temperature of the magnetic system and thus
    the collapse of all magnetic properties.
\end{abstract}
\maketitle


% ===========================================
\section{Introduction}
%
In this paper the analytical and numerical models shall be developed. The advantages of the numerical model shall be made apparent with
the simulation of larger systems than analytically practical. The analytical development of the Ising model was originally done for the 
one dimensional case with no phase transitions. As will be proven quite clearly by the 2 dimensional case there actually exists a phase 
transition for the ferro-magnetic case. 
\\
\\
The analytical model is developed for a small 2x2 lattice and used to verify the validity of the numerical model. This is physically 
relevant to make sure the model is on the right track. A deviation in the more trivial cases would naturally be undesirable. The model 
aims to predict the critical temperature of the ferro magnetic case. 
\\
\\
The Ising model is a model based on statistical mechanics of the spin states of a ferro-magnet. The model takes into account the energy state of same spin and alternate spin neighbours and allows these neighbouring particles to interact with each other. The 2 dimensional case allows for the modelling of a magnetic phase transition. Giving us the prediction of a critical temperature, collapse of the magnetic case and thus a phase transition. 
\\
\\
The Ising model originally did not predict a phase transition, but the original model was only of one dimension. Thus the 2 dimensional case being relevant as this allows us to make this prediction. Thus the utility of the 2 dimensional lattice case becomes rather obvious. 
\\
\\
The model is constructed and simulated in the c++ language and the results is plotted in python. This allows us to simulate the situation rather efficiently. This need for computational speed becomes rather apparent when one considers the need for the 2 dimensional case and the increased need for FLOPs. 
% ===========================================
\section{Methods}\label{sec:methods}

For the Ising model we have studied the 2D square lattices of spins $s_i$. The spin configuration can be up (+1) or down (-1) (as seen in TABLE \ref{tab:possible_states}).

The model uses a lattice with periodic boundary conditions, which have length $L$ and $N$ spins. This gives us

\begin{equation}
    N = L^2
\end{equation}

For our system, the total energy is given by when we sums over all neighbouring (up, down, left, right) pairs of spins ($\langle k,l\rangle $), without double-counting

\begin{equation} \label{eq:tot_energy}
    \mathbf{- J E(\mathbf{s}) = \sum\limits_{\langle k,l\rangle}^Ns_ks_l}
\end{equation}

where $\mathbf{J}$ are the $\mathit{coupling constant}$ and $\mathbf{s}$ represents the spin state of the entire system \textit{microstate} or \textit{spin configuration} and is given by 

\begin{equation}
    \mathbf{s} = \left( s_1, s_2, ... , s_N \right).
\end{equation}

If we sum over all the spin in the system we'll get the total magnetization:

\begin{equation}
    \mathbf{M} (\mathbf{s}) = \sum\limits_i^N s_i.
\end{equation}

To compare the results we get for different lattice sizes, we use magnetization per spin ($m$): 

\begin{equation}
    m (\mathbf{s}) = \frac{M(\mathbf{s})}{N},
\end{equation}

and energy per spin ($\epsilon$):

\begin{equation}
    \epsilon (\mathbf{s}) = \frac{\mathbf{E}(\mathbf{s})}{N}
\end{equation}

We use \textit{Boltzmann distribution} to get the probability for the system state, given a system temperature ($T$):

\begin{equation}
    p(\mathbf{s} ; T) = \frac{1}{Z} e^{- \beta \mathbf{E}(\mathbf{s})},
\end{equation}

where $Z$ is the \textit{partition function} which ia a normalization constant. $\beta$ represents the inverse temperature:

\begin{equation}
    \beta = \frac{1}{k_B T},
\end{equation}
here $k_B$ are called the \textit{Boltzmann constant}.

We also have the partition function ($Z$) summing over all possible $\textbf{s}$ (i):

\begin{equation}
    Z = \sum\limits_{i} e^{- \beta \mathbf{E}(\mathbf{s})},
\end{equation}

which can be expressed analytical as:

\begin{align*}
    Z %&= \sum\limits_{i} e^{- \beta \mathbf{E}(\mathbf{s})} \\
    &= e^{8 \beta J} + 4 + 2 e^{-8 \beta J} + 4 + 4 + e^{-8 \beta J} \\
    &= 2e^{8 \beta J} + 2e^{-8 \beta J} + 12 \\
    &= 4 \cosh (8 \beta J) + 12
\end{align*}

We notice that $\langle E\rangle = \sum\limits_{s}$

\begin{align*}
    \langle E\rangle &= \sum\limits_{s} E(s) p(s;1)\\
    &= \sum\limits_{s} \frac{E(s)}{Z} e^{- \beta E(s)} \\
    &= - \frac{1}{Z} \sum\limits_{s} \frac{\partial}{\partial \beta} e^{- \beta E(s)} \\
    &= - \frac{1}{Z} \frac{\partial}{\partial \beta} \sum\limits_{s} e^{- \beta E(s)} \\
    &= - \frac{1}{Z} \frac{\partial}{\partial \beta} Z \\
    &= -8 \frac{J \sinh (8 \beta J)}{\cosh (8 \beta J) + 3}
\end{align*}

Hence

\begin{equation}
    \langle \epsilon\rangle = \langle \frac{E}{N}\rangle = -2 \frac{J \sinh (8 \beta J)}{\cosh (8 \beta J) + 3}
\end{equation}

which gives us

\begin{equation}
    \langle \epsilon^2\rangle  = \frac{1}{N^2 Z} \frac{\partial^2}{\partial \beta^2} Z = -4 J^2 \frac{J \sinh (8 \beta J)}{\cosh (8 \beta J) + 3}
\end{equation}

For $\langle|m|\rangle$ we get

\begin{align*}
    \langle|m|\rangle  = \frac{\langle|M|\rangle}{N} &= \frac{1}{N Z} \sum\limits_{s} |M(s)| e^{- \beta E(s)} \\
    &= \frac{1}{4 Z} \left( 4 e^{8 \beta J} + 8 + 8 + 4 e^{8 \beta J} \right) \\
    &= \frac{2 e^{8 \beta J}  + 4}{4 \cosh (8 \beta J) + 12} \\
    &= \frac{e^{8 \beta J}  + 2}{2 \cosh (8 \beta J) + 6}
\end{align*}

and 

\begin{align*}
    \langle m^2\rangle = \frac{\langle M^2\rangle}{N^2} &= \frac{1}{N^2 Z} \sum\limits_{s} M(s)^2 e^{-8 \beta E(s)} \\
    &= \frac{1}{16 Z} \left( 16 e^{8 \beta J} + 16 + 16 + 16 e^{8 \beta J} \right) \\
    &= \frac{e^{8 \beta J}  + 1}{2 \cosh (8 \beta J) + 6}
\end{align*}

We get the specific heat capacity, also known as normalized to number of spins, by:

\begin{equation}
    E_{\mathbf{s}} = E_{\text{ext}} + \left( -J \sum\limits_{j = 1}^4 s_i s_j \right)
\end{equation}

\begin{align*}
    \Delta E &= E_{\text{after}} - E_{\text{before}} \\
    &= E_{\text{ext}} - J \sum\limits_{j = 1}^4 s_{\text{after}} s_j - E_{\text{ext}} + J \sum\limits_{j = 1}^4 s_{\text{before}} s_j \\
    &= J \left( \left( -s_ \text{after} + s_{\text{before}} \right) 2 \sum\limits_{j = 1}^4 s_j \right)
\end{align*}

since $s_{\text{after}} = - s_{\text{before}}$, we get:

\begin{equation}
    \Delta E = 2 s_{\text{before}} \sum\limits_{j = 1}^4 s_j
\end{equation}

Mapping gives:

\begin{equation}
    \frac{\Delta E}{4} + 2
\end{equation}

TODO: missing anal for the susceptibility (normalized to number of spins)



% ===========================================
\subsection*{Algorithms}

\begin{figure}
	% NOTE: We only need \begin{figure} ... \end{figure} here because of a compatability issue between the 'revtex4-1' document class and the 'algorithm' environment.
	\begin{algorithm}[H]
		\caption{Metropolis Algorithm}
		\label{algo:metropolis}
		\begin{algorithmic}
			\Procedure{Metropolis}{$x, x', p(x'), i$}
			\State Generate new state proposal $x'$ from $x$
			\State Calculate probability of new state $p(x')$
			\State Generate random number  $i \in [0,1]$
			\State Accept if $i \leq p(x')$, reject if not
			\EndProcedure
		\end{algorithmic}
	\end{algorithm}
\end{figure}

The Metropolis-algorithm is given in \ref{algo:metropolis}. It is an algorithm for generating a Markov Chain Monte Carlo chain ???? needs another sentence
% ===========================================
\section{Results and Discussion}\label{sec:results}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{../figs/testE.pdf} %Imports the figure.
	\caption{}
	\label{fig:testE}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{../figs/testM.pdf} %Imports the figure.
	\caption{}
	\label{fig:testM}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{../figs/testCv.pdf} %Imports the figure.
	\caption{}
	\label{fig:testCv}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{../figs/testX.pdf} %Imports the figure.
	\caption{}
	\label{fig:testX}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{../figs/burn_inE.pdf} %Imports the figure.
	\caption{}
	\label{fig:burn_inE}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{../figs/burn_in|m|.pdf} %Imports the figure.
	\caption{}
	\label{fig:burn_in|m|}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{../figs/hist_T1.pdf} %Imports the figure.
	\caption{}
	\label{fig:hist_T1}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{../figs/hist_T2.pdf} %Imports the figure.
	\caption{}
	\label{fig:hist_T2}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{../figs/<e>_differing_L.pdf} %Imports the figure.
	\caption{}
	\label{fig:e_differing}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{../figs/<|m|>_differing_L.pdf} %Imports the figure.
	\caption{}
	\label{fig:m_differing}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{../figs/Cv_differing_L.pdf} %Imports the figure.
	\caption{}
	\label{fig:Cv_diff_l}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{../figs/X_differing_L.pdf} %Imports the figure.
	\caption{}
	\label{fig:X_diff_l}
\end{figure}
% ===========================================


 
% ===========================================
\section{Conclusion}\label{sec:conclusion}

\onecolumngrid

%\bibliographystyle{apalike}
\bibliography{ref}

\newpage

\appendix

\section{GitHub repository}

\centering
\url{https://github.com/sverrewn/FYS3150/tree/project4/project4} 

\section{Possible states} \label{eq_motion}

\begin{table}[H]
    \centering
    \begin{tabular}{|c|c|l|c|c|}
    \hline
        \multicolumn{1}{|l|}{\textbf{Spins in +1}} & \textbf{Sprin configuration} & $\mathbf{- J E(\vec{s}) = \sum\limits_{\langle k,l\rangle}^Ns_ks_l}$ & \multicolumn{1}{l|}{$\mathbf{M(\vec{s}) = \sum\limits_i^Ns_i}$} & \multicolumn{1}{l|}{\textbf{Degeneracy}} \\ \hline
        4 & 
        
        \begin{tabular}{ll}
            $\uparrow$ & $\uparrow$ \\ 
            $\uparrow$ & $\uparrow$ \\
        \end{tabular}
        
        & $-J(2+2+2+2) = -8J$ & 4 & 1 \\ \hline
        3 & 
        
        \begin{tabular}{ll}
            $\uparrow$ & $\downarrow$ \\ 
            $\uparrow$ & $\uparrow$ \\
        \end{tabular} 
        
        & $-J(0 -2 + 2 + 0) = 0$ & 2 & 4 \\ \hline
        2 & 
        
        \begin{tabular}{ll}
            $\downarrow$ & $\downarrow$ \\ 
            $\uparrow$ & $\uparrow$ \\
        \end{tabular}
        
        & $-J(0 + 0 + 0 + 0) = 0$ & 0 & 4 \\ \hline
        2 & 
        
        \begin{tabular}{ll}
            $\uparrow$ & $\downarrow$ \\ 
            $\downarrow$ & $\uparrow$ \\
        \end{tabular} 
        
        & $-J(-2-2-2-2)= 8J$ & 0 & 2 \\ \hline
        1 & 
        
        \begin{tabular}{ll}
            $\uparrow$ & $\downarrow$ \\ 
            $\downarrow$ & $\downarrow$ \\
        \end{tabular}
        
        & $-J(-2+0 + 0 + 2) = 0$ & -2 & 4 \\ \hline
        0 & 
        
        \begin{tabular}{ll}
            $\downarrow$ & $\downarrow$ \\ 
            $\downarrow$ & $\downarrow$ \\
        \end{tabular}
        
        & $-J(2+2+2+2) = -8J$ & -4 & 1 \\ \hline
    \end{tabular}
    \caption{All possible states of a  $2 \times 2$ lattice with periodic boundary conditions.}
    \label{tab:possible_states}
\end{table}

\end{document}