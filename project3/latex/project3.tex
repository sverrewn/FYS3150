%% USEFUL LINKS:
%% -------------
%%
%% - UiO LaTeX guides:          https://www.mn.uio.no/ifi/tjenester/it/hjelp/latex/
%% - Mathematics:               https://en.wikibooks.org/wiki/LaTeX/Mathematics
%% - Physics:                   https://ctan.uib.no/macros/latex/contrib/physics/physics.pdf
%% - Basics of Tikz:            https://en.wikibooks.org/wiki/LaTeX/PGF/Tikz
%% - All the colors!            https://en.wikibooks.org/wiki/LaTeX/Colors
%% - How to make tables:        https://en.wikibooks.org/wiki/LaTeX/Tables
%% - Code listing styles:       https://en.wikibooks.org/wiki/LaTeX/Source_Code_Listings
%% - \includegraphics           https://en.wikibooks.org/wiki/LaTeX/Importing_Graphics
%% - Learn more about figures:  https://en.wikibooks.org/wiki/LaTeX/Floats,_Figures_and_Captions
%% - Automagic bibliography:    https://en.wikibooks.org/wiki/LaTeX/Bibliography_Management  (this one is kinda difficult the first time)
%%
%%                              (This document is of class "revtex4-1", the REVTeX Guide explains how the class works)
%%   REVTeX Guide:              http://www.physics.csbsju.edu/370/papers/Journal_Style_Manuals/auguide4-1.pdf
%%
%% COMPILING THE .pdf FILE IN THE LINUX IN THE TERMINAL
%% ----------------------------------------------------
%%
%% [terminal]$ pdflatex report_example.tex
%%
%% Run the command twice, always.
%%
%% When using references, footnotes, etc. you should run the following chain of commands:
%%
%% [terminal]$ pdflatex report_example.tex
%% [terminal]$ bibtex report_example
%% [terminal]$ pdflatex report_example.tex
%% [terminal]$ pdflatex report_example.tex
%%
%% This series of commands can of course be gathered into a single-line command:
%% [terminal]$ pdflatex report_example.tex && bibtex report_example.aux && pdflatex report_example.tex && pdflatex report_example.tex
%%
%% ----------------------------------------------------


\documentclass[english,notitlepage,reprint,nofootinbib]{revtex4-1}  % defines the basic parameters of the document
% For preview: skriv i terminal: latexmk -pdf -pvc filnavn
% If you want a single-column, remove "reprint"

% Allows special characters (including æøå)
\usepackage[utf8]{inputenc}
% \usepackage[english]{babel}

%% Note that you may need to download some of these packages manually, it depends on your setup.
%% I recommend downloading TeXMaker, because it includes a large library of the most common packages.

\usepackage{physics,amssymb}  % mathematical symbols (physics imports amsmath)
\include{amsmath}
\usepackage{graphicx}         % include graphics such as plots
\usepackage{xcolor}           % set colors
\usepackage{hyperref}         % automagic cross-referencing
\usepackage{listings}         % display code
\usepackage{subfigure}        % imports a lot of cool and useful figure commands
% \usepackage{float}
%\usepackage[section]{placeins}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{subfigure}
\usepackage{tikz}
\usetikzlibrary{quantikz}
% defines the color of hyperref objects
% Blending two colors:  blue!80!black  =  80% blue and 20% black
\hypersetup{ % this is just my personal choice, feel free to change things
	colorlinks,
	linkcolor={red!50!black},
	citecolor={blue!50!black},
	urlcolor={blue!80!black}}


% ===========================================


\begin{document}
	
	\title{Numerical simulations of the Penning Trap with multiple particles}  % self-explanatory
	\author{Sverre Wehn Noremsaune, Jon Aleksander Prøitz, Marius Torsvoll, Frida Marie Engøy Westby} % self-explanatory
	\date{\today}                             % self-explanatory
	\noaffiliation                            % ignore this, but keep it.
	
	%This is how we create an abstract section.
	\begin{abstract}
		Numerical solutions of the electromagnetic penning trap using numerical methods of differing order. The simulation is developed to handle singular particles as well as a multi particle system of non interacting and interacting particles. The model finds a numerical solution to the penning trap in 3 dimensions, the resulting simulation is thus plotted in a 2 and 3 dimensional environment to study the phase development of the particles. 
	\end{abstract}
	\maketitle
	
	
	% ===========================================
	\section{Introduction}
	%
	This article aims to develop the theoretical and numerical framework for the simulation of a multi particle penning trap environment. Using the numerical methods of RungeKutta4 and Euler-Chromer we develop a simulation capable of handling multiple particle environments in an interacting and non-interacting way. The Euler-Chromer method is used as a verification of the validity of the RK4 method. 
	
	The Penning trap is used in many experimental physical fields and thus its study is essential. Its use varies from practicalities as a storage device for charged particles and as method of studying moving charged particles. Such examples as fission decay products, ions of interest and stable subatomic particles. The study of Penning traps and its effect on charged particles thus becomes an important part of physics. 
	
	Usage of computer simulations allows for the rapid and complex probing of the properties of the electromagnetic trap. This allows us to probe the trap for a multi particle system and the exploration of a dynamic system of interacting system and for non interacting particles. The analytical theoretical framework is developed using trivial physical properties and is thus further implemented in a numerical setting for numerical methods of differing orders. The resulting simulation is then implemented in -----------
	
	% ===========================================
	\section{Methods}\label{sec:methods}
	
	The development of the theoretical framework requires no further knowledge of physics and mathematics other than that of elementary electrodynamics, Newtons second law of motion and some linear algebra. These three tools allows us to develop a comprehensive and general theoretical analytical framework for the Penning Trap. Thus the development of the framework may be described as following. 
	
	% metode for anal
	First we need to declare some of the physical properties and laws used in the development of the theoretical framework.
	
	We have the formulas for the electric field ($\mathbf{E}$) which are given by
	\begin{equation} \label{eq:electric field}
		\mathbf{E} = -\nabla V,
	\end{equation}
	Where $V$ is the electric potential and $\nabla$ denotes the gradient operator.
	
	At a point $\mathbf{r}$, which is set up by the point charges ${q_1, ..., q_n}$, which are distributed at points ${\mathbf{r}_1, ..., \mathbf{r}_n}$
	\begin{equation} \label{eq:electric field2}
		\mathbf{E} = k_e \sum_{j=1}^n q_j \frac{\mathbf{r}-\mathbf{r}_j}{|\mathbf{r}-\mathbf{r}_j|^3}
	\end{equation}
	here $k_e$ is representing Coulomb’s constant.
	
	The Lorentz force ($\mathbf{F}$) are given by
	\begin{equation} \label{eq:Lorentz force}
		\mathbf{F} = q\mathbf{E} + q\mathbf{v}\times \mathbf{B},
	\end{equation}
	where $\mathbf{F}$ is the sum of all forces exerted on a particle, $\mathbf{v}$ is the velocity of the particle, $q$ is the charge of our test particle, the electrical field is represented by ($\mathbf{E}$) and the magnetic field by ($\mathbf{B}$). Given that $\mathbf{B}$ is a homogeneous magnetic field in the positive $z$-direction, we can write $\mathbf{B}$ as
	\begin{equation} \label{eq:Bfield}
		\mathbf{B} = B_0\hat{e}_z = (0, 0, B_0)
	\end{equation}
	$B_0$ is the strength of the field, and given that the magnetic field actually exists it then becomes obvious that $B_0 > 0$.
	
	Using Newtons second law of motion to derive the following relations:
	\begin{equation} \label{eq:newtons2}
		m\ddot{\mathbf{r}} = \sum_i \mathbf{F}_i,
	\end{equation}
	$m$ are the particle mass.
	
	Using Newton’s second law (\ref{eq:newtons2}), we get:
	\begin{equation*}
		m \ddot{v} = \sum_i \vectorbold{F}_i \Leftrightarrow m
		\begin{bmatrix}
			\vectorbold{\ddot{x}} \\
			\vectorbold{\ddot{y}} \\
			\ddot{z}
		\end{bmatrix}
		= \sum_i
		\begin{bmatrix}
			\vectorbold{F}_x \\
			\vectorbold{F}_y \\
			F_z
		\end{bmatrix}
	\end{equation*}
	From this we get that 
	\begin{equation*}
		m \ddot{x} = \sum_i F_{x,i}
	\end{equation*}
	Using this and the vectorized expression for the magnetic field (\ref{eq:Bfield}), we get the following cross product
	\begin{equation*}
		\begin{bmatrix}
			\dot{x} \\
			\dot{y} \\
			0
		\end{bmatrix}
		\times
		\begin{bmatrix}
			0\\
			0 \\
			B_0
		\end{bmatrix}
		=
		\begin{bmatrix}
			B_0 \dot{y} \\
			B_0 \dot{x} \\
			0
		\end{bmatrix}
	\end{equation*}
	With this result and the formula for Lorentz force (\ref{eq:Lorentz force}) we can move on and find $m \ddot{x}$:
	\begin{align*}
		m \ddot{x} &= F_x \\
		&= q E_x + (q \vectorbold{V} \times B)_x \\
		&= -q \frac{\partial v}{\partial x} + q
		\begin{bmatrix}
			\dot{x} \\
			\dot{y} \\
			0
		\end{bmatrix}
		\times
		\begin{bmatrix}
			0 \\
			0 \\
			B_0
		\end{bmatrix} \\
		&= - q \left( - \frac{V_0}{d^2} x \right) + q B_0 \ddot{y} \\
	\end{align*}
	We now define $\omega_0$ as $\frac{q B_0}{m}$ and $\omega_z^2$ as $\frac{2 q V_0}{md^2}$ and get the following
	\begin{equation} \label{eq:newton_x}
		\ddot{x} - \frac{q B_0}{m} \dot{y} - \frac{q V_0}{m d^2} x = 0 \Leftrightarrow \ddot{x} - \omega_0 \dot{y} - \frac{1}{2} \omega^2_z x = 0
	\end{equation}
	Then we can repeat this for $\ddot{y}$ and $\ddot{z}$ which gives us
	\begin{align*}
		m \ddot{y} &= F_y \\
		&= q E_y + (q \vectorbold{V} \times B)_y \\
		&= - q \frac{\partial v}{\partial y} - q B_o \dot{x}
	\end{align*}
	for $m \ddot{y}$ and 
	\begin{equation} \label{eq:newton_y}
		\ddot{y} + \frac{q B_0}{m} \dot{x} - \frac{q V_0}{m d^2} = 0
	\end{equation}
	for $\ddot{y}$.
	\begin{equation*}
		m \ddot{z} = q E_z = -q \frac{\partial v}{\partial z} = - \frac{4 q v_0}{2 d^2} z
	\end{equation*}
	for $m \ddot{z}$ and
	\begin{equation} \label{eq:newton_z}
		\ddot{z} + \omega^2_z z = 0
	\end{equation}
	for $\ddot{z}$. We are also setting $q > 0$ here.
	
	We are now introducing a new formula, which connects \ref{eq:newton_x} and \ref{eq:newton_y} from above.
	\begin{equation*}
		f(t) = x(t) + iy(t)
	\end{equation*}
	Then we can rewrite \ref{eq:newton_x} and \ref{eq:newton_y} as
	\begin{align} \label{eq:newton_f}
		m \ddot{x} - \omega_0 \dot{y} - \frac{1}{2} \omega_z^2 x + i(\ddot{y} + \omega_z^2) = 0 \nonumber \\
		\ddot{x} + i \ddot{y} + i \omega_0 \dot{x} - \omega_0 \dot{y} - \frac{1}{2} \omega_z^2 (x + iy) = 0 \nonumber \\
		\ddot{f} + i \omega_0 (\dot{x} + i \dot{y}) - \frac{1}{2} \omega_z^2 f = 0 \nonumber \\
		\ddot{f} + i \omega_0 \dot{f} - \frac{1}{2} \omega_z^2 f = 0
	\end{align}
	This (\ref{eq:newton_f}) formula have a general solution given as
	\begin{equation} \label{eq:gen_sol}
		f(t) = A_+ e^{-i(\omega_+ t + \phi_+)} + A_- e^{-i(\omega_- t + \phi_-)}
	\end{equation}
	here is $\phi_+$ and $\phi_-$ defined as constant phases, $A_+$ and $A_-$ as the positive amplitudes, and 
	\begin{equation*}
		\omega_\pm = \frac{\omega_0 \pm \sqrt{\omega_0^2 - 2\omega_z^2}}{2}.
	\end{equation*}
	We also have $x(t) = \text{Re} f(t)$ and $y(t) = \text{Im} f(t)$ which gives us the physical coordinates for \ref{eq:newton_f}.
	
	To obtain a bounded solution for the movement in the $xy$-plane (or $|f(t)| < \infty$ when $t\to\infty$) we need the constraints $\omega_0$ and $\omega_z$. First lets assume $\omega \pm \in \mathbb{R}$, then we se that
	$\omega_0^2 - 2 \omega_z^2 > 0 \Leftrightarrow \omega_0^2 > 2 \omega z^2$.
	Putting in the values for $\omega$ (\ref{eq:newton_x}) to express this as a constraint that relates the penning trap parameters to the particle properties and we get:
	\begin{equation*}
		\left( \frac{q B_0}{m} \right) ^2 > \left( \frac{2 q v_0}{m d^2} \right)
	\end{equation*}
	which can be written as
	\begin{equation*}
		\frac{q}{m} B_0^2 > \frac{4 v_0}{d^2} 
	\end{equation*}
	
	If we rewrite (\ref{eq:gen_sol}) we get
	\begin{equation*}
		f(t) = A_+ (\cos \omega_+ t + i \sin \omega_+ t) + A_- (\cos \omega_- t + i \sin \omega_- t)
	\end{equation*}
	
	Next we can use this to find the particles upper and lower bounds from the distance from the origin in the in the $xy$-plane, given the physical coordinates for the real part
	\begin{equation*} 
		\Re \left( f(t) \right) + A_+ \cos \omega_+ t + A_- \cos \omega_- t
	\end{equation*}
	and for the imaginary part
	\begin{equation*}
		\Im \left( f(t) \right) + A_+ \sin \omega_+ t + A_- \sin \omega_- t
	\end{equation*}
	Then we are getting upper bounds by when $x(t)$ and $y(t)$ are in upper phase:
	\begin{equation*}
		R_+ = A_+ + A_-
	\end{equation*}
	
	and lower bounds when they are in opposite phase:
	\begin{equation*}
		R_- = | A_+ + A_- |
	\end{equation*}
	
	To test our numerical solution, we have made a specific analytical solution where we are assuming that we have have a single charged particle with charge $q$, mass $m$ and the following initial conditions:
	$$ x(0) = x_0, \qquad \dot{x}(0) = 0, $$
	$$ y(0) = 0, \qquad \dot{y}(0) = v_0, $$
	$$ z(0) = z_0, \qquad \dot{z}(0) = 0. $$
	With those initial conditions we can easily see that:
	\begin{equation*}
		x(0) = \Re \left( f(0) \right) = A_+ + A_- = x_0
	\end{equation*}
	and
	\begin{equation*}
		y(0) = \Im \left( f(0) \right) = 0
	\end{equation*}
	
	Next, we can see that if we derivate (\ref{eq:newton_f}) we will get
	\begin{align*}
		\dot{f} &= \frac{d}{dt} \left[ A_+ e^{- \omega_+ t} + A_- e^{- \omega_- t}  \right] \\
		&= -A_+ i \omega_+ e^{-i \omega t} - A_- i \omega e^{-i \omega t}
	\end{align*}
	
	Using this result, we can see that:
	
	\begin{equation*}
		\dot{y} = \Im( \dot{f} ) = -A_+ \omega_+ \cos \omega_+ t - A_- \omega_- \cos \omega_- t
	\end{equation*}
	Putting this together with the initial values for $\dot{y} (0)$, and we get
	\begin{equation*}
		\dot{y} (0) = v_0 = A_+ \omega_+ - A_- \omega_- 
	\end{equation*}
	Doing the same for $\dot{x} (0)$ and we get:
	\begin{equation*}
		\dot{x} = \Re ( \dot{f} ) = A_+ \omega_+ \sin \omega_+ t + A_- \omega_- \sin \omega_- t = 0
	\end{equation*}
	
	We can now see that for the initial values
	\begin{equation} \label{eq:i}
		x(0) = x_0 \Rightarrow A_+ + A_- = x_0
	\end{equation}
	and
	\begin{equation} \label{eq:ii}
		y(0) = v_0 \Rightarrow A_+ \omega_+ - A_- \omega_- = v_0
	\end{equation}
	
	We can change (\ref{eq:i}) and get the following
	\begin{equation} \label{eq:iii}
		A_- = x_0 - A_+
	\end{equation}
	Then is we sets (\ref{eq:iii}) in to (\ref{eq:ii}) we get that one of the specific solution for $f(t)$ is:
	\begin{align} \label{eq:iv}
		-A_+ \omega_+ - x_0 \omega_- + A_+ \omega_- &= v_0 \nonumber \\
		A_+ (\omega_- \omega_+) &= v_0 + x_0 \omega_- \nonumber \\
		A_+ &= \frac{v_0 + x_0 \omega_-}{\omega_- - \omega_+}
	\end{align}
	Next we sets (\ref{eq:iv}) in to (\ref{eq:iii}) which gives us the other specific solution for $f(t)$:
	\begin{align*}
		A_- &= x_0 - \frac{v_0 + x_0 \omega_-}{\omega_- - \omega_+} \\
		&= \frac{x_0 (\omega_- - \omega_+) - v_0 - x_0 \omega_-}{\omega_- - \omega_+} \\
		&= \frac{-x_0 \omega_+ - v_0}{\omega_- - \omega_+} \\
		&= - \frac{v_0 + x_0 \omega_+}{\omega_- - \omega_+}
	\end{align*}
	
	If we rewrite (\ref{eq:newton_z}) to 
	\begin{equation*}
		z = A \cos (\omega_z z) + B \sin (\omega_z z)
	\end{equation*}
	and look at the initial value for $z(0)$, we see that
	\begin{equation*}
		z(0) = z_0 \Rightarrow A \cos \omega_z \theta + B \sin \omega_z \theta = z_0 \Rightarrow A = z_0.
	\end{equation*}
	If we derivate $z$, we get 
	\begin{equation*}
		\dot{z} = \omega_z (-z_0 \sin \omega_z t + V \cos \omega_z t).
	\end{equation*}
	Which with the initial value gives us:
	\begin{equation*}
		\dot{z}(0) = \omega_z (- z_0 \sin \omega_z \dot 0 + B \cos \omega_z \theta) = w_z B = 0 \Rightarrow B = 0.
	\end{equation*}
	
	Now we can see that the specific solution for $z(t)$:
	\begin{equation*}
		z(t) = z_0 \cos (\omega_z t)
	\end{equation*}
	
	
	% ===========================================
\subsection*{Algorithms}
%
The numerical integration method Runge-Kutta 4 is given in algorithm~\ref{algo:rk4}. The algorithm calculates a weighted average using multiple values for the gradient, $k_n$, by using the current position, half a step forward, and a whole step forward, to find the next position. We use 4 points for the weighted average, hence fourth order Runge-Kutta.

%
\begin{figure}
	% NOTE: We only need \begin{figure} ... \end{figure} here because of a compatability issue between the 'revtex4-1' document class and the 'algorithm' environment.
	\begin{algorithm}[H]
		\caption{$4th$ order Runge-Kutta}
		\label{algo:rk4}
		\begin{algorithmic}
			\Procedure{RK4}{$k_1, k_2, k_3, k_4, \Delta t, f, t, y$}
			\State $k_1 \leftarrow \Delta t f(t_i, y_i)$  
			\State $k_2 \leftarrow \Delta t f(t_i + \frac{1}{2}\Delta t, y_i + \frac{1}{2}k_1)$
			\State $k_3 \leftarrow \Delta t f(t_i + \frac{1}{2}\Delta t, y_i + \frac{1}{2}k_2) $
			\State $k_4 \leftarrow \Delta t f(t_{i+1}, y_i + k_3)$
			\State $y_{i+1} = y_i + \frac{1}{6}[k_1 + 2k_2 + 2k_3 + k_4]$
			\EndProcedure
		\end{algorithmic}
	\end{algorithm}
\end{figure}
Euler-Cromer is a numerical integration method for coupled equations, given in \ref{algo:ec}. The method calculates the next step for the first equations, and uses that result to solve the second equation.
\begin{figure}
	\begin{algorithm}[H]
		\caption{Euler-Cromer}
		\label{algo:ec}
		\begin{algorithmic}
			\Procedure{EC}{$v, x, \Delta t, f$}
			\State $v_{i+1} \leftarrow v_i + \Delta t f(t_i, y_i)$
			\State $x_{i+1} \leftarrow x_i + \Delta t v_{i+1}$
			\EndProcedure
		\end{algorithmic}
	\end{algorithm}
\end{figure}

% ===========================================
\section{Results}\label{sec:results}
%
To test the Penning trap simulation we firstly plot the $z$ values of a single particle simulated for $100 \mu s$

\begin{figure}[h!]
	\centering
	\includegraphics[scale=0.5]{../figs/one_particle_100us_z.pdf} %Imports the figure.
	\caption{The motion of a single particle in the z-direction in the default Penning Trap configuration}
	\label{fig:100us-z}
\end{figure}

secondly we simulate two particles with and without interaction with the same initial conditions and plot the $xy$-coordinates

\begin{figure}[h!]
	\centering
	\includegraphics[scale=0.5]{../figs/two_particles_100us.pdf} %Imports the figure.
	\caption{The motion of a two particles in the $xy$ plane with and without particles interaction in the default Penning trap configuration}
	\label{fig:particles_xy}
\end{figure}

Thirdly we make phase space plots for $(x, v_x), (y, v_y), (z, v_z)$

\begin{figure}[h!]
	\centering
	\includegraphics[scale=0.5]{../figs/phase_space.pdf} %Imports the figure.
	\caption{Phase space plot for $(x, v_x), (y, v_y), (z, v_z)$ in the default Penning Trap configuration}
	\label{fig:phase}
\end{figure}

fourth we make a $3d$ of the the same two particles with and without interaction

\begin{figure}[h!]
	\centering
	\includegraphics[scale=0.5]{../figs/3d_plot_interaction.pdf} %Imports the figure.
	\caption{The motion of a two particles in default Penning Trap configuration with particle interaction}
	\label{fig:3di}
\end{figure}

\begin{figure}[h!]
	\centering
	\includegraphics[scale=0.5]{../figs/3d_plot_no_interaction.pdf} %Imports the figure.
	\caption{The motion of a single particle in the default Penning Trap configuration without particle interaction}
	\label{fig:3dni}
\end{figure}

fifth we compare the numerical approximation with the analytical solution for $5$ different values of $dt$

\begin{figure}[h!]
	\centering
	\includegraphics[scale=0.5]{../figs/phase_space.pdf} %Imports the figure.
	\caption{The relative error of EC vs the analytical solution}
	\label{fig:rel_ec}
\end{figure}

\begin{figure}[h!]
	\centering
	\includegraphics[scale=0.5]{../figs/phase_space.pdf} %Imports the figure.
	\caption{The relative error of RK4 vs the analytical solution}
	\label{fig:rel_rk4}
\end{figure}

Finally we calculate the error convergence for EC and RK4 for the five different step sizes


We now simulate our Penning trap with 100 particles and look at how many remain

\begin{figure}[h!]
	\centering
	\includegraphics[scale=0.5]{../figs/remaining_particles.pdf} %Imports the figure.
	\caption{The number of particles remaining as a function of the applied angular frequency $\omega_V$}
	\label{fig:rel_rk4}
\end{figure}


	% ===========================================
	\section{Results}\label{sec:results}
	%
	To test the midpoint rule algorithm, we perform the integration of $f(x)$ using different choices for the number of subintervals. The results are listed in table \ref{tab:midpointruletab}.\footnote{A general style recommendation is to avoid having vertical lines in tables. There are of course exceptions, but in most cases vertical lines will make a table less readable.}
	%
	\begin{table}[h!]
		\centering
		\begin{tabular}{c@{\hspace{1cm}} c}
			\hline
			Number of subintervals & Integral value \\
			\hline
			$10^1$  &  0.3086 \\
			$10^2$  &  0.2550 \\
			$10^3$  &  0.2505 \\
			$10^4$  &  0.2500 \\
			% $10$  &  0.3086 \\
			% $100$  &  0.2550 \\
			% $1 000$  &  0.2505 \\
			% $10 000$  &  0.2500 \\
			\hline
		\end{tabular}\caption{Approximate values for the integral of $f(x) = x^3$ on the interval $[0,1]$, as obtained with the midpoint rule with different numbers of integration subintervals.}\label{tab:midpointruletab}
	\end{table}
	
	In figure \ref{fig:rel_err} we show the relative error as a function of the number of subintervals $n$.
	\begin{figure}[h!]
		\centering %Centers the figure
		\caption{The relative error versus the number of integration subintervals ($n$) when using the midpoint rule to estimate the integral $\int_0^1 x^3\dd x$. \textit{Given that this plot is based only on a handful of data points, it should also show the data points using some form of point markers, like the dots here. When presented only with a continuous line, it is not necessarily clear for the reader if the result is based on a large or small number of data points.}}
		\label{fig:rel_err}
	\end{figure}
	
	\textit{Note especially how we reference both the table and the figure with a short explanation of their content. Always do this! In the figure/table captions we can also add additional information, such as information about how the figure/table was produced. You can also do this in the main text if you like. When writing the figure/table captions, keep in mind the general rule of thumb that an expert on the topic should be able to understand the gist of your report simply by reading the abstract and look at the figures/tables and read their corresponding captions.}
	
	
	% ===========================================
	\section{Discussion}\label{sec:discussion}
	%
	\textit{Note that you are free to merge the presentation and discussion of the results into a single section of your report. This can in many cases lead to a more fluid presentation. If you do this, we recommend you use ``Results and discussion'' or similar for the section title.}
	
	From table \ref{tab:midpointruletab}, we note that our implementation reproduces the analytical results to four digits precision when the integration range is divided into $n = 10^4$ subintervals. This indicates that that our implementation of the algorithm is correct.
	
	From figure \ref{fig:rel_err}, we see that $\log_{10}(\epsilon)$ decreases linearly with $\log_{2}(n)$. From this, it should be possible to extract the convergence rate of our implementation of the midpoint rule. From a theoretical point of view we know that the midpoint rule should have a convergence rate of $\mathcal{O}(h^2)$. To properly verify our implementation, we should have estimated the convergence rate from our results and compared it to this theoretical rate. Without doing so, we cannot know that the our implementation of the algorithm is correct, even though we have seen that the numerical approximation converges to the correct answer in \ref{tab:midpointruletab}.
	
	\textit{Although this is a somewhat silly example, please note the following: We are to-the-point in our discussion of the results, and we only make strong claims about what we are actually certain about. In the discussion it is important to try to be as concise as possible --- long paragraphs that only make very general points are typically of limited interest. Note that we also highlight aspects of our analysis that could have been improved and that might form a topic for future work.}
	
	
	% ===========================================
	\section{Conclusion}\label{sec:conclusion}
	\textit{In this section we state three things in a concise manner: what we have done, what we have found, and what should or could be done in the future.}
	
	We have investigated an implementation of the midpoint rule for numerical integration. As a first validation test we have checked that our implementation of the method reproduces the analytical result for the definite integral of $f(x) = x^3$ on $x \in [0,1]$, achieving a four-digit precision when the integration range is divided into $n=10^4$ subintervals. Furthermore, we have presented results for how the relative error of the method varies with the number of subintervals. To use these results to extract a precise estimate for the convergence rate of the method remains a topic for future work. As such, while our implementation of the midpoint rule has passed the initial validation tests, more work is needed to fully assess the validity of the implementation.
	
	\onecolumngrid
	
	%\bibliographystyle{apalike}
	\bibliography{ref}
	
	
\end{document} 